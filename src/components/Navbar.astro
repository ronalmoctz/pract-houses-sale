---
import { navLinks, SOCIAL } from "../constants/index";
---

<nav id="navbar" class="navbar">
  <div class="nav-inner container-default">
    <a href="#home" class="brand">
      <p>MOON HOUSE</p>
    </a>

    <ul class="nav-links">
      {
        navLinks.map((link) => (
          <li key={link.id}>
            <a href={`#${link.id}`} data-section={link.id} class="nav-link">
              {link.title}
            </a>
          </li>
        ))
      }
    </ul>

    <ul class="nav-social">
      {
        SOCIAL.map(({ url, image, name, label }) => (
          <li key={name}>
            <a
              href={url}
              target="_blank"
              rel="noopener noreferrer"
              aria-label={label ?? name}
              class="nav-icon"
            >
              <image.logo />
            </a>
          </li>
        ))
      }
    </ul>

    <div class="nav-phone text-sm font-semibold whitespace-nowrap">
      <a href="tel:+521234567890">+52 123 456 7890</a>
    </div>
  </div>
</nav>

<script type="module">
  // NAVBAR: lightweight, performant scroll + active section detection
  const navbar = document.getElementById("navbar");
  const navInner = document.querySelector(".nav-inner");
  const links = document.querySelectorAll(".nav-link");
  const sections = document.querySelectorAll("section[id]");

  // Throttle the scroll toggle using rAF
  let ticking = false;
  function onScroll() {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        const triggerPoint = 50;
        navbar.classList.toggle(
          "navbar-scrolled",
          window.scrollY > triggerPoint
        );
        ticking = false;
      });
      ticking = true;
    }
  }
  window.addEventListener("scroll", onScroll, { passive: true });

  // Use IntersectionObserver to mark active section (better perf)
  const observerOptions = {
    root: null,
    rootMargin: "-40% 0px -50% 0px",
    threshold: 0,
  };

  const io = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      const id = entry.target.getAttribute("id");
      const link = document.querySelector(`.nav-link[data-section="${id}"]`);
      if (entry.isIntersecting) {
        // remove on others then set active
        links.forEach((l) => l.classList.remove("active"));
        if (link) link.classList.add("active");
      }
    });
  }, observerOptions);

  sections.forEach((section) => io.observe(section));

  links.forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const id = link.getAttribute("href").slice(1);
      const el = document.getElementById(id);
      if (el) {
        el.scrollIntoView({ behavior: "smooth", block: "start" });
      }
      links.forEach((l) => l.classList.remove("active"));
      link.classList.add("active");
    });
  });
</script>
