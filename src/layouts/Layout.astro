---
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/webp" href="/sketch.webp" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1f2937" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Amber House" />

    <!-- Primary metadata -->
    <title>Amber House - Construcción de Casas Modernas en México</title>
    <meta
      name="description"
      content="Amber House construye casas modernas y contemporáneas en México. Especialistas en diseño, construcción y renovación de viviendas de alta calidad. ¡Solicita tu presentación personalizada!"
    />
    <meta
      name="keywords"
      content="casas modernas México, construcción de casas, diseño arquitectónico, viviendas contemporáneas, renovación de casas, arquitectura moderna, construcción residencial, casas de lujo, proyectos inmobiliarios, Amber House"
    />
    <meta name="author" content="Amber House" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://house-landing-page-cyan.vercel.app" />

    <!-- Open Graph / Facebook, WhatsApp, etc. -->
    <meta
      property="og:title"
      content="Amber House - Construcción de Casas Modernas en México"
    />
    <meta
      property="og:description"
      content="Amber House construye casas modernas y contemporáneas en México. Especialistas en diseño, construcción y renovación de viviendas de alta calidad. ¡Solicita tu presentación personalizada!"
    />
    <meta
      property="og:image"
      content="https://house-landing-page-cyan.vercel.app/banner.jpg"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="Casa moderna Amber House - Construcción y diseño de casas contemporáneas en México"
    />
    <meta
      property="og:url"
      content="https://house-landing-page-cyan.vercel.app"
    />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Amber House" />
    <meta property="og:locale" content="es_MX" />

    <!-- Twitter / X -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Amber House - Construcción de Casas Modernas en México"
    />
    <meta
      name="twitter:description"
      content="Amber House construye casas modernas y contemporáneas en México. Especialistas en diseño, construcción y renovación de viviendas de alta calidad."
    />
    <meta
      name="twitter:image"
      content="https://house-landing-page-cyan.vercel.app/banner.jpg"
    />
    <meta
      name="twitter:image:alt"
      content="Casa moderna Amber House - Construcción y diseño de casas contemporáneas en México"
    />

    <!-- Analytics: loader will be injected only after consent -->
    <script type="text/plain" data-cookiecategory="analytics">
      /* placeholder for gtag - will be injected dynamically after consent */
    </script>

    <!-- Structured Data JSON-LD -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Amber House",
        "description": "Amber House construye casas modernas y contemporáneas en México. Especialistas en diseño, construcción y renovación de viviendas de alta calidad.",
        "url": "https://house-landing-page-cyan.vercel.app",
        "logo": "https://house-landing-page-cyan.vercel.app/sketch.webp",
        "image": "https://house-landing-page-cyan.vercel.app/banner.jpg",
        "telephone": "+52 123 456 7890",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "MX",
          "addressRegion": "México"
        },
        "sameAs": [
          "https://www.facebook.com/amberhouse",
          "https://www.instagram.com/amberhouse",
          "https://www.linkedin.com/company/amberhouse"
        ],
        "serviceArea": {
          "@type": "Country",
          "name": "México"
        },
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Servicios de Construcción",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Diseño de Casas Modernas",
                "description": "Diseño arquitectónico de casas contemporáneas"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Construcción de Viviendas",
                "description": "Construcción de casas de alta calidad"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Renovación de Casas",
                "description": "Renovación y remodelación de viviendas existentes"
              }
            }
          ]
        }
      }
    </script>
  </head>

  <body>
    <main>
      <Navbar />
    </main>

    <slot />

    <Footer />

    <!-- Cookie consent banner (simple, local) -->
    <div
      id="cookie-consent"
      class="fixed bottom-4 left-4 right-4 md:bottom-6 md:left-auto md:right-6 bg-white/95 shadow-lg rounded-lg p-4 flex items-center gap-3 z-50"
      style="display:none"
    >
      <div class="flex-1 text-sm">
        Este sitio usa cookies para analíticas (Google Analytics). ¿Deseas
        habilitarlas?
      </div>
      <div class="flex gap-2">
        <button
          id="accept-cookies"
          class="bg-blue-600 text-white px-3 py-1 rounded">Aceptar</button
        >
        <button
          id="decline-cookies"
          class="bg-gray-200 text-gray-800 px-3 py-1 rounded">Rechazar</button
        >
      </div>
    </div>

    <script type="module">
      // Mostrar banner si no hay decisión previa
      const CONSENT_KEY = "analytics_consent";
      function showBanner() {
        const el = document.getElementById("cookie-consent");
        if (el) el.style.display = "flex";
      }
      function hideBanner() {
        const el = document.getElementById("cookie-consent");
        if (el) el.style.display = "none";
      }

      function setConsent(value) {
        try {
          localStorage.setItem(CONSENT_KEY, value ? "granted" : "denied");
        } catch (e) {
          // storage puede fallar en modo privado
        }
      }

      function getConsent() {
        try {
          return localStorage.getItem(CONSENT_KEY);
        } catch (e) {
          return null;
        }
      }

      async function loadGtag() {
        if (window._gtag_loaded) return;
        const id = "G-D271HWNMCQ";
        const script = document.createElement("script");
        script.async = true;
        script.src = `https://www.googletagmanager.com/gtag/js?id=${id}`;
        document.head.appendChild(script);

        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        window.gtag = window.gtag || gtag;
        gtag("js", new Date());
        gtag("config", id, { anonymize_ip: true });
        window._gtag_loaded = true;
      }

      // Inicialización del banner y botones
      document.addEventListener("DOMContentLoaded", () => {
        const decision = getConsent();
        if (decision === "granted") {
          loadGtag();
        } else if (decision === "denied") {
          // no cargar analytics
        } else {
          // mostrar banner para elegir
          showBanner();
        }

        const acceptBtn = document.getElementById("accept-cookies");
        const declineBtn = document.getElementById("decline-cookies");
        acceptBtn?.addEventListener("click", async () => {
          setConsent(true);
          hideBanner();
          await loadGtag();
        });
        declineBtn?.addEventListener("click", () => {
          setConsent(false);
          hideBanner();
        });
      });
    </script>

    <!-- Cargar animaciones cliente correctamente como módulo -->
    <script>
      import {
        initAnimations,
        cleanupAnimations,
      } from "../scripts/animations.js";

      // Variable para controlar si ya se inicializaron las animaciones
      let animationsLoaded = false;

      document.addEventListener("DOMContentLoaded", () => {
        if (!animationsLoaded) {
          initAnimations();
          animationsLoaded = true;
        }
      });

      // Cleanup al salir de la página (para SPA o navegación)
      window.addEventListener("beforeunload", () => {
        cleanupAnimations();
      });

      // Cleanup cuando se oculta la página
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          // Pausar animaciones cuando la página no es visible
          gsap.globalTimeline.pause();
        } else {
          // Reanudar animaciones cuando la página vuelve a ser visible
          gsap.globalTimeline.resume();
        }
      });
    </script>
  </body>
</html>
